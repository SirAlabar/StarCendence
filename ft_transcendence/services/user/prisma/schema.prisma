// == USER SERVICE == //
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:/app/data/user.db"
}

// Core user model
model UserProfile {
  id        String   @id // same as AuthUser id
  email     String   @unique
  username  String   @unique
  bio       String?
  avatarUrl String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  friendRequestSent    Friendship[] @relation("FriendRequestsSent")
  friendRequestReceived Friendship[] @relation("FriendRequestsReceived")

  // TO IMPLEMENT MATCH HISTORY LATER

  @@map("users")
}

// Friendship model to represent friend requests and relationships
model Friendship {
  id         Int      @id @default(autoincrement())
  requester  UserProfile @relation("FriendRequestsSent", fields: [requesterId], references: [id])
  requesterId String
  recipient  UserProfile @relation("FriendRequestsReceived", fields: [recipientId], references: [id])
  recipientId String
  status      String
  createdAt  DateTime @default(now())

  @@unique([requesterId, recipientId])
  @@map("friendships")
}

model MatchHistory {
  id         Int      @id @default(autoincrement())
  player1Id  String
  player2Id  String
  result     String
  playedAt   DateTime @default(now())

  @@map("match_history")
}